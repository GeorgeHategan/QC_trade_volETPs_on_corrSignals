# region imports
from AlgorithmImports import *
from datetime import datetime, timedelta
import os
# endregion


class VolETPsCorrSignals(QCAlgorithm):
    """
    VIX Short Strategy based on COR1M vs COR3M correlation
    
    Strategy:
    - Loads correlation data from CSV files
    - Calculates RSI of (COR1M - COR3M) difference
    - Shorts VXX when RSI < 50 (oversold, reversal signal)
    - Closes short when VXX > 25 or RSI recovers
    """

    def initialize(self):
        # Start date must be after COR3M data availability (2024-02-06)
        self.set_start_date(2024, 2, 6)
        self.set_end_date(2026, 1, 30)
        self.set_cash(100000)
        
        # Initialize hourly data dictionaries
        self.cor1m_hourly_data = {}
        self.cor3m_hourly_data = {}
        
        # Load CSV data - try file first, then fall back to minimal embedded data
        self.debug(f"[INIT] Working directory: {os.getcwd()}")
        self._load_csv_data("data/custom/cor1m.csv")
        self._load_csv_data("data/custom/cor3m.csv")
        
        # If no files found, create minimal embedded fallback data
        # This ensures cloud backtesting works even without files
        if not self.cor1m_hourly_data or len(self.cor1m_hourly_data) == 0:
            self.debug(f"[INIT] ✗ No CSV files found - using embedded fallback data")
            self._load_embedded_data()
        
        self.debug(f"[INIT] COR1M data: {len(self.cor1m_hourly_data)} hourly entries")
        self.debug(f"[INIT] COR3M data: {len(self.cor3m_hourly_data)} hourly entries")
        
        # Add trading instrument with HOURLY resolution for intraday trading
        self.vxx = self.add_equity("VXX", Resolution.HOURLY).symbol
        
        # Add correlation signals as custom data with HOURLY resolution
        self.cor1m = self.add_data("COR1M", Resolution.HOURLY).symbol
        self.cor3m = self.add_data("COR3M", Resolution.HOURLY).symbol
        
        # Indicators
        self.rsi_diff = RelativeStrengthIndex(14)
        
        # Parameters
        self.rsi_threshold = 50
        self.vxx_close_threshold = 25
        self.position_size = 0.50
        
        # State tracking
        self.is_short = False
        self.entry_price = 0
        self.trade_count = 0
        self.last_cor1m = None
        self.last_cor3m = None
    
    def _load_csv_data(self, filepath):
        """Load CSV data from file into a dictionary - stores HOURLY data with datetime keys"""
        hourly_data = {}
        daily_data = {}
        
        try:
            self.debug(f"[DATA LOAD] Attempting to load: {filepath}")
            
            if not os.path.exists(filepath):
                self.debug(f"[ERROR] File not found: {filepath}")
                self.debug(f"[DEBUG] Working directory: {os.getcwd()}")
                return hourly_data
            
            self.debug(f"[DATA LOAD] File found! Reading hourly data...")
            
            with open(filepath, 'r') as f:
                lines = f.readlines()
                self.debug(f"[DATA LOAD] Total lines: {len(lines)}")
                
                valid_rows = 0
                for line_num, line in enumerate(lines[1:], start=2):
                    if not line.strip():
                        continue
                    parts = line.strip().split(',')
                    if len(parts) < 5:
                        continue
                    try:
                        time_str = parts[0].strip()
                        # Parse ISO8601 timestamp with timezone
                        dt_str = time_str.split('+')[0] if '+' in time_str else time_str.split('Z')[0]
                        dt = datetime.fromisoformat(dt_str)
                        
                        # Use ISO format as key to preserve hourly granularity
                        hour_key = dt.isoformat()
                        ohlc = {
                            'time': dt,
                            'open': float(parts[1]),
                            'high': float(parts[2]),
                            'low': float(parts[3]),
                            'close': float(parts[4])
                        }
                        hourly_data[hour_key] = ohlc
                        
                        # Also keep daily data (last OHLC of day for backward compatibility)
                        date_key = dt.date()
                        daily_data[date_key] = ohlc
                        
                        valid_rows += 1
                        
                        if valid_rows % 500 == 0:
                            self.debug(f"[DATA LOAD] Processed {valid_rows} hourly bars...")
                    except Exception as e:
                        continue
                
                self.debug(f"[DATA LOAD] ✓ SUCCESS: {valid_rows} hourly entries loaded")
                if len(hourly_data) > 0:
                    times = sorted(hourly_data.keys())
                    self.debug(f"[DATA LOAD] Time range: {times[0]} → {times[-1]}")
        except Exception as e:
            self.debug(f"[ERROR] Failed to load {filepath}: {str(e)}")
        
        # Store both hourly and daily data on self
        if filepath.endswith('cor1m.csv'):
            self.cor1m_hourly_data = hourly_data
            self.cor1m_data = daily_data
        elif filepath.endswith('cor3m.csv'):
            self.cor3m_hourly_data = hourly_data
            self.cor3m_data = daily_data
        
        return hourly_data
    
    def _load_embedded_data(self):
        """Load minimal embedded fallback data for cloud compatibility"""
        # Sample data for testing - enough to verify the strategy works
        # Real production would load all 971 COR1M and 498 COR3M dates
        # Format: date object keys with OHLC dictionary values (matching CSV format)
        from datetime import date
        
        sample_cor1m_raw = {
            '2022-03-18': 42.12,
            '2022-03-21': 40.69,
            '2022-03-22': 40.18,
            '2022-03-23': 40.84,
            '2022-03-24': 35.25,
            '2022-03-25': 31.16,
            '2022-03-28': 24.37,
            '2022-03-29': 24.39,
            '2022-03-30': 25.54,
            '2022-03-31': 27.91,
            '2022-04-01': 23.33,
            '2022-04-04': 21.29,
            '2022-04-05': 27.35,
            '2022-04-06': 28.28,
            '2022-04-07': 26.5,
            '2022-04-08': 24.7,
            '2022-04-11': 32.12,
            '2022-04-12': 33.8,
            '2022-04-13': 29.76,
            '2022-04-14': 32.78,
            '2022-04-18': 31.68,
            '2022-04-19': 31.49,
            '2022-04-20': 24.85,
            '2022-04-21': 30.09,
            '2022-04-22': 37.97,
            '2022-04-25': 35.2,
            '2022-04-26': 42.59,
            '2022-04-27': 43.57,
            '2022-04-28': 46.18,
            '2022-04-29': 50.45,
            '2022-05-02': 52.42,
            '2022-05-03': 48.16,
            '2022-05-04': 46.06,
            '2022-05-05': 51.07,
            '2022-05-06': 48.53,
            '2022-05-09': 51.45,
            '2022-05-10': 52.7,
            '2022-05-11': 49.39,
            '2022-05-12': 48.33,
            '2022-05-13': 46.56,
            '2022-05-16': 45.4,
            '2022-05-17': 49.25,
            '2022-05-18': 49.7,
            '2022-05-19': 48.24,
            '2022-05-20': 48.81,
            '2022-05-23': 50.19,
            '2022-05-24': 49.49,
            '2022-05-25': 50.65,
            '2022-05-26': 52.17,
            '2022-05-27': 50.24,
            '2022-05-31': 48.84,
            '2022-06-01': 47.45,
            '2022-06-02': 46.58,
            '2022-06-03': 43.49,
            '2022-06-06': 45.43,
            '2022-06-07': 46.84,
            '2022-06-08': 47.41,
            '2022-06-09': 50.42,
            '2022-06-10': 49.42,
            '2022-06-13': 53.86,
            '2022-06-14': 54.6,
            '2022-06-15': 55.41,
            '2022-06-16': 52.46,
            '2022-06-17': 52.1,
            '2022-06-21': 56.49,
            '2022-06-22': 50.81,
            '2022-06-23': 51.21,
            '2022-06-24': 46.72,
            '2022-06-27': 41.8,
            '2022-06-28': 44.62,
            '2022-06-29': 44.7,
            '2022-06-30': 43.35,
            '2022-07-01': 40.64,
            '2022-07-05': 41.83,
            '2022-07-06': 40.94,
            '2022-07-07': 41.59,
            '2022-07-08': 37.3,
            '2022-07-11': 39.49,
            '2022-07-12': 40.71,
            '2022-07-13': 40.62,
            '2022-07-14': 40.06,
            '2022-07-15': 35.86,
            '2022-07-18': 37.21,
            '2022-07-19': 37.43,
            '2022-07-20': 37.77,
            '2022-07-21': 34.97,
            '2022-07-22': 32.27,
            '2022-07-25': 32.62,
            '2022-07-26': 34.49,
            '2022-07-27': 39.85,
            '2022-07-28': 38.46,
            '2022-07-29': 39.54,
            '2022-08-01': 41.82,
            '2022-08-02': 45.15,
            '2022-08-03': 41.8,
            '2022-08-04': 39.29,
            '2022-08-05': 39.59,
            '2022-08-08': 38.49,
            '2022-08-09': 40.04,
            '2022-08-10': 37.75,
            '2022-08-11': 38.04,
            '2022-08-12': 36.03,
            '2022-08-15': 38.68,
            '2022-08-16': 40.07,
            '2022-08-17': 40.78,
            '2022-08-18': 40.96,
            '2022-08-19': 40.33,
            '2022-08-22': 46.69,
            '2022-08-23': 49.13,
            '2022-08-24': 46.61,
            '2022-08-25': 46.48,
            '2022-08-26': 49.1,
            '2022-08-29': 50.94,
            '2022-08-30': 50.97,
            '2022-08-31': 50.26,
            '2022-09-01': 49.12,
            '2022-09-02': 46.76,
            '2022-09-06': 50.62,
            '2022-09-07': 48.17,
            '2022-09-08': 46.38,
            '2022-09-09': 46.19,
            '2022-09-12': 49.81,
            '2022-09-13': 51.32,
            '2022-09-14': 51.63,
            '2022-09-15': 51.29,
            '2022-09-16': 50.02,
            '2022-09-19': 48.57,
            '2022-09-20': 52.47,
            '2022-09-21': 53.92,
            '2022-09-22': 51.84,
            '2022-09-23': 50.02,
            '2022-09-26': 50.67,
            '2022-09-27': 49.86,
            '2022-09-28': 45.8,
            '2022-09-29': 45.14,
            '2022-09-30': 42.95,
            '2022-10-03': 45.55,
            '2022-10-04': 46.72,
            '2022-10-05': 44.42,
            '2022-10-06': 46.17,
            '2022-10-07': 44.56,
            '2022-10-10': 46.93,
            '2022-10-11': 49.89,
            '2022-10-12': 48.93,
            '2022-10-13': 48.54,
            '2022-10-14': 46.87,
            '2022-10-17': 49.07,
            '2022-10-18': 47.73,
            '2022-10-19': 48.3,
            '2022-10-20': 48.62,
            '2022-10-21': 50.62,
            '2022-10-24': 52.25,
            '2022-10-25': 50.71,
            '2022-10-26': 50.56,
            '2022-10-27': 48.17,
            '2022-10-28': 55.47,
            '2022-10-31': 54.0,
            '2022-11-01': 55.46,
            '2022-11-02': 54.45,
            '2022-11-03': 52.8,
            '2022-11-04': 49.71,
            '2022-11-07': 48.06,
            '2022-11-08': 51.71,
            '2022-11-09': 50.17,
            '2022-11-10': 46.26,
            '2022-11-11': 39.3,
            '2022-11-14': 45.95,
            '2022-11-15': 48.45,
            '2022-11-16': 46.86,
            '2022-11-17': 48.28,
            '2022-11-18': 47.5,
            '2022-11-21': 44.66,
            '2022-11-22': 45.05,
            '2022-11-23': 42.13,
            '2022-11-25': 40.24,
            '2022-11-28': 43.38,
            '2022-11-29': 43.58,
            '2022-11-30': 45.16,
            '2022-12-01': 41.86,
            '2022-12-02': 39.15,
            '2022-12-05': 40.79,
            '2022-12-06': 43.6,
            '2022-12-07': 45.59,
            '2022-12-08': 43.52,
            '2022-12-09': 43.42,
            '2022-12-12': 46.76,
            '2022-12-13': 47.26,
            '2022-12-14': 43.03,
            '2022-12-15': 44.54,
            '2022-12-16': 45.29,
            '2022-12-19': 45.26,
            '2022-12-20': 43.65,
            '2022-12-21': 42.7,
            '2022-12-22': 42.18,
            '2022-12-23': 39.48,
            '2022-12-27': 38.23,
            '2022-12-28': 38.84,
            '2022-12-29': 36.56,
            '2022-12-30': 34.95,
            '2023-01-03': 36.38,
            '2023-01-04': 34.62,
            '2023-01-05': 34.95,
            '2023-01-06': 32.47,
            '2023-01-09': 34.48,
            '2023-01-10': 31.4,
            '2023-01-11': 31.64,
            '2023-01-12': 25.3,
            '2023-01-13': 24.89,
            '2023-01-17': 28.31,
            '2023-01-18': 31.43,
            '2023-01-19': 30.64,
            '2023-01-20': 31.23,
            '2023-01-23': 29.66,
            '2023-01-24': 28.14,
            '2023-01-25': 29.25,
            '2023-01-26': 30.07,
            '2023-01-27': 27.41,
            '2023-01-30': 29.66,
            '2023-01-31': 29.05,
            '2023-02-01': 26.18,
            '2023-02-02': 24.31,
            '2023-02-03': 27.89,
            '2023-02-06': 31.24,
            '2023-02-07': 29.91,
            '2023-02-08': 31.41,
            '2023-02-09': 33.16,
            '2023-02-10': 33.75,
            '2023-02-13': 34.35,
            '2023-02-14': 31.9,
            '2023-02-15': 30.64,
            '2023-02-16': 34.27,
            '2023-02-17': 34.55,
            '2023-02-21': 43.26,
            '2023-02-22': 42.81,
            '2023-02-23': 40.62,
            '2023-02-24': 42.26,
            '2023-02-27': 40.21,
            '2023-02-28': 41.83,
            '2023-03-01': 41.97,
            '2023-03-02': 40.55,
            '2023-03-03': 37.51,
            '2023-03-06': 37.76,
            '2023-03-07': 41.54,
            '2023-03-08': 40.03,
            '2023-03-09': 45.19,
            '2023-03-10': 45.75,
            '2023-03-13': 51.0,
            '2023-03-14': 46.22,
            '2023-03-15': 45.87,
            '2023-03-16': 40.49,
            '2023-03-17': 45.47,
            '2023-03-20': 43.7,
            '2023-03-21': 39.49,
            '2023-03-22': 43.15,
            '2023-03-23': 40.83,
            '2023-03-24': 35.37,
            '2023-03-27': 31.07,
            '2023-03-28': 31.08,
            '2023-03-29': 30.05,
            '2023-03-30': 27.04,
            '2023-03-31': 26.14,
            '2023-04-03': 27.11,
            '2023-04-04': 27.89,
            '2023-04-05': 28.65,
            '2023-04-06': 26.54,
            '2023-04-10': 25.95,
            '2023-04-11': 27.42,
            '2023-04-12': 27.83,
            '2023-04-13': 24.66,
            '2023-04-14': 23.29,
            '2023-04-17': 22.96,
            '2023-04-18': 23.44,
            '2023-04-19': 23.36,
            '2023-04-20': 24.28,
            '2023-04-21': 24.02,
            '2023-04-24': 24.03,
            '2023-04-25': 28.73,
            '2023-04-26': 31.82,
            '2023-04-27': 27.38,
            '2023-04-28': 24.96,
            '2023-05-01': 25.09,
            '2023-05-02': 30.56,
            '2023-05-03': 32.33,
            '2023-05-04': 36.15,
            '2023-05-05': 31.48,
            '2023-05-08': 29.68,
            '2023-05-09': 33.12,
            '2023-05-10': 30.07,
            '2023-05-11': 29.06,
            '2023-05-12': 28.8,
            '2023-05-15': 29.96,
            '2023-05-16': 33.54,
            '2023-05-17': 31.02,
            '2023-05-18': 28.25,
            '2023-05-19': 30.25,
            '2023-05-22': 29.29,
            '2023-05-23': 33.09,
            '2023-05-24': 35.18,
            '2023-05-25': 29.36,
            '2023-05-26': 23.44,
            '2023-05-30': 22.03,
            '2023-05-31': 23.14,
            '2023-06-01': 19.05,
            '2023-06-02': 19.47,
            '2023-06-05': 20.62,
            '2023-06-06': 20.7,
            '2023-06-07': 19.07,
            '2023-06-08': 17.83,
            '2023-06-09': 17.49,
            '2023-06-12': 20.78,
            '2023-06-13': 20.64,
            '2023-06-14': 18.1,
            '2023-06-15': 19.17,
            '2023-06-16': 18.01,
            '2023-06-20': 17.68,
            '2023-06-21': 17.45,
            '2023-06-22': 15.57,
            '2023-06-23': 15.5,
            '2023-06-26': 15.19,
            '2023-06-27': 13.97,
            '2023-06-28': 12.75,
            '2023-06-29': 12.49,
            '2023-06-30': 12.52,
            '2023-07-03': 12.17,
            '2023-07-05': 13.59,
            '2023-07-06': 15.04,
            '2023-07-07': 13.16,
            '2023-07-10': 13.26,
            '2023-07-11': 13.6,
            '2023-07-12': 10.68,
            '2023-07-13': 10.16,
            '2023-07-14': 9.56,
            '2023-07-17': 9.59,
            '2023-07-18': 9.08,
            '2023-07-19': 9.82,
            '2023-07-20': 10.01,
            '2023-07-21': 9.34,
            '2023-07-24': 9.38,
            '2023-07-25': 9.25,
            '2023-07-26': 10.79,
            '2023-07-27': 13.2,
            '2023-07-28': 12.58,
            '2023-07-31': 12.59,
            '2023-08-01': 13.81,
            '2023-08-02': 17.51,
            '2023-08-03': 16.87,
            '2023-08-04': 20.96,
            '2023-08-07': 18.5,
            '2023-08-08': 19.99,
            '2023-08-09': 20.46,
            '2023-08-10': 21.69,
            '2023-08-11': 19.59,
            '2023-08-14': 19.35,
            '2023-08-15': 23.23,
            '2023-08-16': 24.74,
            '2023-08-17': 27.14,
            '2023-08-18': 25.33,
            '2023-08-21': 25.57,
            '2023-08-22': 25.06,
            '2023-08-23': 22.76,
            '2023-08-24': 28.35,
            '2023-08-25': 25.18,
            '2023-08-28': 23.92,
            '2023-08-29': 22.62,
            '2023-08-30': 20.98,
            '2023-08-31': 20.16,
            '2023-09-01': 19.58,
            '2023-09-05': 21.3,
            '2023-09-06': 23.08,
            '2023-09-07': 21.84,
            '2023-09-08': 20.8,
            '2023-09-11': 20.4,
            '2023-09-12': 22.8,
            '2023-09-13': 20.5,
            '2023-09-14': 18.06,
            '2023-09-15': 21.06,
            '2023-09-18': 22.16,
            '2023-09-19': 22.82,
            '2023-09-20': 25.52,
            '2023-09-21': 29.12,
            '2023-09-22': 27.03,
            '2023-09-25': 24.25,
            '2023-09-26': 26.88,
            '2023-09-27': 25.5,
            '2023-09-28': 23.73,
            '2023-09-29': 24.67,
            '2023-10-02': 24.62,
            '2023-10-03': 26.62,
            '2023-10-04': 25.01,
            '2023-10-05': 24.09,
            '2023-10-06': 22.24,
            '2023-10-09': 22.37,
            '2023-10-10': 21.1,
            '2023-10-11': 18.53,
            '2023-10-12': 19.45,
            '2023-10-13': 22.43,
            '2023-10-16': 19.88,
            '2023-10-17': 21.77,
            '2023-10-18': 23.81,
            '2023-10-19': 29.42,
            '2023-10-20': 29.09,
            '2023-10-23': 27.07,
            '2023-10-24': 24.08,
            '2023-10-25': 28.95,
            '2023-10-26': 28.95,
            '2023-10-27': 34.46,
            '2023-10-30': 32.23,
            '2023-10-31': 30.27,
            '2023-11-01': 28.46,
            '2023-11-02': 25.2,
            '2023-11-03': 24.31,
            '2023-11-06': 24.42,
            '2023-11-07': 24.97,
            '2023-11-08': 23.43,
            '2023-11-09': 24.38,
            '2023-11-10': 20.38,
            '2023-11-13': 23.83,
            '2023-11-14': 21.67,
            '2023-11-15': 21.44,
            '2023-11-16': 19.6,
            '2023-11-17': 18.91,
            '2023-11-20': 19.62,
            '2023-11-21': 20.36,
            '2023-11-22': 22.41,
            '2023-11-24': 20.13,
            '2023-11-27': 21.09,
            '2023-11-28': 22.04,
            '2023-11-29': 23.4,
            '2023-11-30': 23.91,
            '2023-12-01': 23.81,
            '2023-12-04': 22.94,
            '2023-12-05': 22.91,
            '2023-12-06': 24.33,
            '2023-12-07': 23.74,
            '2023-12-08': 21.72,
            '2023-12-11': 21.48,
            '2023-12-12': 20.19,
            '2023-12-13': 20.1,
            '2023-12-14': 16.92,
            '2023-12-15': 18.03,
            '2023-12-18': 19.43,
            '2023-12-19': 20.48,
            '2023-12-20': 21.54,
            '2023-12-21': 21.15,
            '2023-12-22': 20.48,
            '2023-12-26': 17.85,
            '2023-12-27': 15.9,
            '2023-12-28': 15.15,
            '2023-12-29': 14.24,
            '2024-01-02': 13.88,
            '2024-01-03': 15.93,
            '2024-01-04': 15.89,
            '2024-01-05': 14.43,
            '2024-01-08': 13.1,
            '2024-01-09': 12.42,
            '2024-01-10': 12.06,
            '2024-01-11': 10.9,
            '2024-01-12': 11.35,
            '2024-01-16': 14.04,
            '2024-01-17': 15.79,
            '2024-01-18': 14.2,
            '2024-01-19': 12.03,
            '2024-01-22': 10.82,
            '2024-01-23': 10.22,
            '2024-01-24': 10.69,
            '2024-01-25': 10.78,
            '2024-01-26': 10.69,
            '2024-01-29': 11.39,
            '2024-01-30': 10.3,
            '2024-01-31': 15.31,
            '2024-02-01': 13.99,
            '2024-02-02': 16.43,
            '2024-02-05': 13.93,
            '2024-02-06': 14.72,
            '2024-02-07': 15.08,
            '2024-02-08': 14.25,
            '2024-02-09': 13.8,
            '2024-02-12': 14.54,
            '2024-02-13': 15.51,
            '2024-02-14': 14.16,
            '2024-02-15': 13.2,
            '2024-02-16': 13.3,
            '2024-02-20': 17.18,
            '2024-02-21': 17.41,
            '2024-02-22': 18.05,
            '2024-02-23': 16.15,
            '2024-02-26': 16.12,
            '2024-02-27': 15.52,
            '2024-02-28': 16.21,
            '2024-02-29': 15.83,
            '2024-03-01': 13.98,
            '2024-03-04': 13.42,
            '2024-03-05': 14.65,
            '2024-03-06': 14.67,
            '2024-03-07': 12.45,
            '2024-03-08': 12.62,
            '2024-03-11': 15.89,
            '2024-03-12': 11.72,
            '2024-03-13': 11.33,
            '2024-03-14': 13.68,
            '2024-03-15': 14.38,
            '2024-03-18': 15.15,
            '2024-03-19': 16.92,
            '2024-03-20': 15.85,
            '2024-03-21': 12.38,
            '2024-03-22': 11.06,
            '2024-03-25': 9.55,
            '2024-03-26': 9.43,
            '2024-03-27': 9.01,
            '2024-03-28': 9.38,
            '2024-04-01': 9.7,
            '2024-04-02': 11.87,
            '2024-04-03': 11.96,
            '2024-04-04': 14.83,
            '2024-04-05': 14.56,
            '2024-04-08': 12.89,
            '2024-04-09': 13.32,
            '2024-04-10': 15.13,
            '2024-04-11': 12.66,
            '2024-04-12': 15.88,
            '2024-04-15': 21.1,
            '2024-04-16': 20.11,
            '2024-04-17': 19.58,
            '2024-04-18': 18.66,
            '2024-04-19': 18.79,
            '2024-04-22': 15.37,
            '2024-04-23': 13.04,
            '2024-04-24': 13.05,
            '2024-04-25': 11.17,
            '2024-04-26': 12.83,
            '2024-04-29': 11.32,
            '2024-04-30': 14.16,
            '2024-05-01': 17.46,
            '2024-05-02': 16.34,
            '2024-05-03': 14.61,
            '2024-05-06': 14.7,
            '2024-05-07': 14.75,
            '2024-05-08': 14.24,
            '2024-05-09': 13.41,
            '2024-05-10': 12.89,
            '2024-05-13': 16.83,
            '2024-05-14': 16.37,
            '2024-05-15': 12.59,
            '2024-05-16': 12.14,
            '2024-05-17': 11.45,
            '2024-05-20': 12.27,
            '2024-05-21': 11.43,
            '2024-05-22': 12.1,
            '2024-05-23': 14.47,
            '2024-05-24': 12.73,
            '2024-05-28': 11.71,
            '2024-05-29': 15.24,
            '2024-05-30': 15.71,
            '2024-05-31': 12.59,
            '2024-06-03': 13.92,
            '2024-06-04': 15.6,
            '2024-06-05': 12.94,
            '2024-06-06': 12.06,
            '2024-06-07': 11.56,
            '2024-06-10': 14.25,
            '2024-06-11': 15.13,
            '2024-06-12': 10.91,
            '2024-06-13': 8.89,
            '2024-06-14': 9.41,
            '2024-06-17': 9.32,
            '2024-06-18': 8.71,
            '2024-06-20': 8.62,
            '2024-06-21': 7.92,
            '2024-06-24': 8.48,
            '2024-06-25': 7.96,
            '2024-06-26': 6.83,
            '2024-06-27': 5.88,
            '2024-06-28': 5.59,
            '2024-07-01': 5.13,
            '2024-07-02': 4.97,
            '2024-07-03': 4.47,
            '2024-07-05': 4.06,
            '2024-07-08': 3.82,
            '2024-07-09': 4.03,
            '2024-07-10': 4.12,
            '2024-07-11': 3.87,
            '2024-07-12': 2.93,
            '2024-07-15': 4.81,
            '2024-07-16': 5.45,
            '2024-07-17': 7.06,
            '2024-07-18': 8.47,
            '2024-07-19': 10.05,
            '2024-07-22': 8.65,
            '2024-07-23': 9.2,
            '2024-07-24': 15.24,
            '2024-07-25': 15.92,
            '2024-07-26': 11.77,
            '2024-07-29': 11.51,
            '2024-07-30': 14.13,
            '2024-07-31': 11.9,
            '2024-08-01': 15.7,
            '2024-08-02': 21.85,
            '2024-08-05': 39.62,
            '2024-08-06': 32.22,
            '2024-08-07': 32.29,
            '2024-08-08': 27.94,
            '2024-08-09': 22.72,
            '2024-08-12': 23.3,
            '2024-08-13': 18.54,
            '2024-08-14': 14.33,
            '2024-08-15': 12.22,
            '2024-08-16': 10.62,
            '2024-08-19': 10.86,
            '2024-08-20': 11.75,
            '2024-08-21': 12.56,
            '2024-08-22': 12.14,
            '2024-08-23': 9.49,
            '2024-08-26': 8.76,
            '2024-08-27': 8.61,
            '2024-08-28': 11.57,
            '2024-08-29': 14.14,
            '2024-08-30': 13.73,
            '2024-09-03': 22.41,
            '2024-09-04': 26.31,
            '2024-09-05': 23.82,
            '2024-09-06': 29.29,
            '2024-09-09': 25.43,
            '2024-09-10': 25.43,
            '2024-09-11': 21.25,
            '2024-09-12': 18.58,
            '2024-09-13': 17.55,
            '2024-09-16': 18.31,
            '2024-09-17': 19.07,
            '2024-09-18': 20.37,
            '2024-09-19': 15.92,
            '2024-09-20': 15.4,
            '2024-09-23': 14.41,
            '2024-09-24': 12.47,
            '2024-09-25': 12.22,
            '2024-09-26': 10.82,
            '2024-09-27': 12.36,
            '2024-09-30': 10.92,
            '2024-10-01': 14.68,
            '2024-10-02': 13.85,
            '2024-10-03': 14.55,
            '2024-10-04': 11.24,
            '2024-10-07': 20.45,
            '2024-10-08': 18.61,
            '2024-10-09': 17.6,
            '2024-10-10': 16.92,
            '2024-10-11': 16.96,
            '2024-10-14': 16.65,
            '2024-10-15': 17.34,
            '2024-10-16': 15.77,
            '2024-10-17': 13.39,
            '2024-10-18': 12.94,
            '2024-10-21': 12.15,
            '2024-10-22': 12.41,
            '2024-10-23': 13.94,
            '2024-10-24': 13.23,
            '2024-10-25': 15.08,
            '2024-10-28': 14.6,
            '2024-10-29': 13.83,
            '2024-10-30': 16.57,
            '2024-10-31': 22.18,
            '2024-11-01': 25.05,
            '2024-11-04': 25.36,
            '2024-11-05': 21.83,
            '2024-11-06': 13.74,
            '2024-11-07': 12.76,
            '2024-11-08': 11.64,
            '2024-11-11': 10.85,
            '2024-11-12': 9.96,
            '2024-11-13': 8.83,
            '2024-11-14': 9.1,
            '2024-11-15': 10.54,
            '2024-11-18': 12.12,
            '2024-11-19': 13.47,
            '2024-11-20': 14.01,
            '2024-11-21': 16.41,
            '2024-11-22': 13.11,
            '2024-11-25': 12.14,
            '2024-11-26': 12.37,
            '2024-11-27': 13.31,
            '2024-11-29': 11.25,
            '2024-12-02': 10.73,
            '2024-12-03': 11.05,
            '2024-12-04': 10.79,
            '2024-12-05': 10.25,
            '2024-12-06': 8.27,
            '2024-12-09': 10.07,
            '2024-12-10': 9.94,
            '2024-12-11': 8.24,
            '2024-12-12': 9.16,
            '2024-12-13': 8.17,
            '2024-12-16': 8.46,
            '2024-12-17': 9.74,
            '2024-12-18': 27.89,
            '2024-12-19': 23.32,
            '2024-12-20': 19.24,
            '2024-12-23': 15.53,
            '2024-12-24': 10.4,
            '2024-12-26': 9.41,
            '2024-12-27': 11.84,
            '2024-12-30': 14.56,
            '2024-12-31': 14.2,
            '2025-01-02': 15.07,
            '2025-01-03': 11.48,
            '2025-01-06': 8.85,
            '2025-01-07': 13.33,
            '2025-01-08': 14.15,
            '2025-01-10': 16.86,
            '2025-01-13': 16.62,
            '2025-01-14': 16.76,
            '2025-01-15': 12.03,
            '2025-01-16': 12.35,
            '2025-01-17': 11.41,
            '2025-01-21': 9.01,
            '2025-01-22': 8.19,
            '2025-01-23': 7.93,
            '2025-01-24': 7.64,
            '2025-01-27': 8.82,
            '2025-01-28': 7.97,
            '2025-01-29': 6.5,
            '2025-01-30': 6.47,
            '2025-01-31': 8.42,
            '2025-02-03': 12.19,
            '2025-02-04': 11.17,
            '2025-02-05': 9.34,
            '2025-02-06': 9.52,
            '2025-02-07': 11.14,
            '2025-02-10': 10.77,
            '2025-02-11': 10.92,
            '2025-02-12': 11.45,
            '2025-02-13': 8.36,
            '2025-02-14': 7.7,
            '2025-02-18': 8.53,
            '2025-02-19': 8.78,
            '2025-02-20': 8.88,
            '2025-02-21': 13.71,
            '2025-02-24': 14.94,
            '2025-02-25': 15.14,
            '2025-02-26': 16.61,
            '2025-02-27': 23.58,
            '2025-02-28': 20.73,
            '2025-03-03': 25.6,
            '2025-03-04': 26.36,
            '2025-03-05': 27.22,
            '2025-03-06': 31.52,
            '2025-03-07': 30.11,
            '2025-03-10': 32.74,
            '2025-03-11': 35.67,
            '2025-03-12': 33.65,
            '2025-03-13': 32.3,
            '2025-03-14': 30.48,
            '2025-03-17': 27.77,
            '2025-03-18': 30.07,
            '2025-03-19': 27.41,
            '2025-03-20': 26.73,
            '2025-03-21': 27.23,
            '2025-03-24': 22.59,
            '2025-03-25': 21.7,
            '2025-03-26': 23.19,
            '2025-03-27': 22.65,
            '2025-03-28': 27.15,
            '2025-03-31': 24.33,
            '2025-04-01': 23.63,
            '2025-04-02': 19.5,
            '2025-04-03': 32.65,
            '2025-04-04': 46.13,
            '2025-04-07': 44.9,
            '2025-04-08': 49.42,
            '2025-04-09': 36.45,
            '2025-04-10': 42.47,
            '2025-04-11': 42.53,
            '2025-04-14': 34.7,
            '2025-04-15': 36.43,
            '2025-04-16': 41.22,
            '2025-04-17': 36.86,
            '2025-04-21': 43.51,
            '2025-04-22': 40.05,
            '2025-04-23': 37.22,
            '2025-04-24': 32.75,
            '2025-04-25': 31.19,
            '2025-04-28': 30.75,
            '2025-04-29': 29.79,
            '2025-04-30': 29.97,
            '2025-05-01': 32.43,
            '2025-05-02': 29.34,
            '2025-05-05': 31.42,
            '2025-05-06': 34.74,
            '2025-05-07': 31.71,
            '2025-05-08': 29.7,
            '2025-05-09': 30.07,
            '2025-05-12': 22.22,
            '2025-05-13': 18.97,
            '2025-05-14': 18.06,
            '2025-05-15': 16.93,
            '2025-05-16': 16.68,
            '2025-05-19': 19.86,
            '2025-05-20': 19.73,
            '2025-05-21': 24.07,
            '2025-05-22': 22.52,
            '2025-05-23': 26.61,
            '2025-05-27': 18.34,
            '2025-05-28': 20.39,
            '2025-05-29': 22.73,
            '2025-05-30': 22.89,
            '2025-06-02': 23.76,
            '2025-06-03': 22.65,
            '2025-06-04': 22.2,
            '2025-06-05': 21.54,
            '2025-06-06': 19.88,
            '2025-06-09': 21.65,
            '2025-06-10': 21.78,
            '2025-06-11': 21.86,
            '2025-06-12': 23.06,
            '2025-06-13': 27.49,
            '2025-06-16': 24.27,
            '2025-06-17': 30.82,
            '2025-06-18': 27.88,
            '2025-06-20': 27.87,
            '2025-06-23': 25.27,
            '2025-06-24': 21.16,
            '2025-06-25': 18.44,
            '2025-06-26': 16.66,
            '2025-06-27': 15.13,
            '2025-06-30': 14.48,
            '2025-07-01': 14.89,
            '2025-07-02': 14.32,
            '2025-07-03': 14.14,
            '2025-07-07': 15.78,
            '2025-07-08': 13.82,
            '2025-07-09': 12.28,
            '2025-07-10': 11.37,
            '2025-07-11': 12.11,
            '2025-07-14': 14.02,
            '2025-07-15': 14.73,
            '2025-07-16': 14.49,
            '2025-07-17': 12.59,
            '2025-07-18': 12.92,
            '2025-07-21': 13.53,
            '2025-07-22': 12.94,
            '2025-07-23': 10.98,
            '2025-07-24': 11.81,
            '2025-07-25': 10.82,
            '2025-07-28': 9.54,
            '2025-07-29': 10.69,
            '2025-07-30': 8.84,
            '2025-07-31': 11.79,
            '2025-08-01': 20.1,
            '2025-08-04': 13.53,
            '2025-08-05': 16.13,
            '2025-08-06': 14.32,
            '2025-08-07': 13.65,
            '2025-08-08': 10.93,
            '2025-08-11': 13.07,
            '2025-08-12': 10.76,
            '2025-08-13': 9.24,
            '2025-08-14': 9.88,
            '2025-08-15': 10.22,
            '2025-08-18': 11.29,
            '2025-08-19': 12.09,
            '2025-08-20': 13.16,
            '2025-08-21': 15.58,
            '2025-08-22': 9.56,
            '2025-08-25': 9.99,
            '2025-08-26': 9.3,
            '2025-08-27': 10.19,
            '2025-08-28': 12.56,
            '2025-08-29': 14.37,
            '2025-09-02': 17.85,
            '2025-09-03': 17.5,
            '2025-09-04': 15.79,
            '2025-09-05': 15.29,
            '2025-09-08': 14.82,
            '2025-09-09': 14.48,
            '2025-09-10': 13.23,
            '2025-09-11': 12.98,
            '2025-09-12': 12.34,
            '2025-09-15': 13.63,
            '2025-09-16': 14.78,
            '2025-09-17': 14.07,
            '2025-09-18': 13.46,
            '2025-09-19': 13.29,
            '2025-09-22': 12.58,
            '2025-09-23': 14.07,
            '2025-09-24': 13.38,
            '2025-09-25': 13.47,
            '2025-09-26': 10.61,
            '2025-09-29': 10.43,
            '2025-09-30': 9.84,
            '2025-10-01': 8.95,
            '2025-10-02': 9.42,
            '2025-10-03': 9.22,
            '2025-10-06': 7.42,
            '2025-10-07': 9.35,
            '2025-10-08': 7.73,
            '2025-10-09': 7.85,
            '2025-10-10': 14.51,
            '2025-10-13': 11.07,
            '2025-10-14': 14.02,
            '2025-10-15': 13.42,
            '2025-10-16': 19.41,
            '2025-10-17': 12.98,
            '2025-10-20': 9.09,
            '2025-10-21': 9.35,
            '2025-10-22': 10.29,
            '2025-10-23': 8.98,
            '2025-10-24': 7.71,
            '2025-10-27': 7.3,
            '2025-10-28': 7.78,
            '2025-10-29': 7.63,
            '2025-10-30': 10.97,
            '2025-10-31': 12.52,
            '2025-11-03': 11.95,
            '2025-11-04': 16.37,
            '2025-11-05': 14.59,
            '2025-11-06': 16.37,
            '2025-11-07': 15.12,
            '2025-11-10': 12.27,
            '2025-11-11': 12.78,
            '2025-11-12': 13.34,
            '2025-11-13': 16.65,
            '2025-11-14': 17.32,
            '2025-11-17': 21.71,
            '2025-11-18': 24.68,
            '2025-11-19': 22.58,
            '2025-11-20': 27.78,
            '2025-11-21': 24.64,
            '2025-11-24': 20.74,
            '2025-11-25': 15.77,
            '2025-11-26': 15.53,
            '2025-11-28': 15.0,
            '2025-12-01': 17.15,
            '2025-12-02': 16.68,
            '2025-12-03': 14.7,
            '2025-12-04': 14.04,
            '2025-12-05': 13.53,
            '2025-12-08': 15.34,
            '2025-12-09': 16.57,
            '2025-12-10': 13.64,
            '2025-12-11': 11.53,
            '2025-12-12': 13.89,
            '2025-12-15': 16.25,
            '2025-12-16': 17.03,
            '2025-12-17': 19.54,
            '2025-12-18': 18.12,
            '2025-12-19': 13.78,
            '2025-12-22': 11.99,
            '2025-12-23': 12.74,
            '2025-12-24': 12.3,
            '2025-12-26': 10.31,
            '2025-12-29': 11.12,
            '2025-12-30': 11.86,
            '2025-12-31': 12.39,
            '2026-01-02': 9.91,
            '2026-01-05': 8.77,
            '2026-01-06': 8.31,
            '2026-01-07': 9.0,
            '2026-01-08': 8.4,
            '2026-01-09': 6.79,
            '2026-01-12': 7.68,
            '2026-01-13': 8.79,
            '2026-01-14': 9.8,
            '2026-01-15': 8.32,
            '2026-01-16': 8.58,
            '2026-01-20': 14.29,
            '2026-01-21': 10.33,
            '2026-01-22': 8.57,
            '2026-01-23': 8.33,
            '2026-01-26': 7.58,
            '2026-01-27': 7.73,
            '2026-01-28': 7.4,
            '2026-01-29': 8.62,
            '2026-01-30': 10.75,
        }
        
        sample_cor3m_raw = {
            '2024-02-06': 17.75,
            '2024-02-07': 17.44,
            '2024-02-08': 17.2,
            '2024-02-09': 17.16,
            '2024-02-12': 17.44,
            '2024-02-13': 18.06,
            '2024-02-14': 17.01,
            '2024-02-15': 16.2,
            '2024-02-16': 16.61,
            '2024-02-20': 18.02,
            '2024-02-21': 18.03,
            '2024-02-22': 17.19,
            '2024-02-23': 16.46,
            '2024-02-26': 16.01,
            '2024-02-27': 15.58,
            '2024-02-28': 16.13,
            '2024-02-29': 15.66,
            '2024-03-01': 15.11,
            '2024-03-04': 14.45,
            '2024-03-05': 15.02,
            '2024-03-06': 14.64,
            '2024-03-07': 12.96,
            '2024-03-08': 13.83,
            '2024-03-11': 14.87,
            '2024-03-12': 12.27,
            '2024-03-13': 11.79,
            '2024-03-14': 13.03,
            '2024-03-15': 13.42,
            '2024-03-18': 13.49,
            '2024-03-19': 13.91,
            '2024-03-20': 13.49,
            '2024-03-21': 12.24,
            '2024-03-22': 11.94,
            '2024-03-25': 12.26,
            '2024-03-26': 12.28,
            '2024-03-27': 12.59,
            '2024-03-28': 13.23,
            '2024-04-01': 13.95,
            '2024-04-02': 15.44,
            '2024-04-03': 15.12,
            '2024-04-04': 17.31,
            '2024-04-05': 17.57,
            '2024-04-08': 16.41,
            '2024-04-09': 16.63,
            '2024-04-10': 17.76,
            '2024-04-11': 16.4,
            '2024-04-12': 19.32,
            '2024-04-15': 22.6,
            '2024-04-16': 21.34,
            '2024-04-17': 21.65,
            '2024-04-18': 21.62,
            '2024-04-19': 23.66,
            '2024-04-22': 20.85,
            '2024-04-23': 18.89,
            '2024-04-24': 18.81,
            '2024-04-25': 16.96,
            '2024-04-26': 18.03,
            '2024-04-29': 16.74,
            '2024-04-30': 18.03,
            '2024-05-01': 19.7,
            '2024-05-02': 18.8,
            '2024-05-03': 17.89,
            '2024-05-06': 16.97,
            '2024-05-07': 16.92,
            '2024-05-08': 16.55,
            '2024-05-09': 16.24,
            '2024-05-10': 16.4,
            '2024-05-13': 16.62,
            '2024-05-14': 15.86,
            '2024-05-15': 14.12,
            '2024-05-16': 14.16,
            '2024-05-17': 14.1,
            '2024-05-20': 14.1,
            '2024-05-21': 13.29,
            '2024-05-22': 13.59,
            '2024-05-23': 13.89,
            '2024-05-24': 13.02,
            '2024-05-28': 12.04,
            '2024-05-29': 13.48,
            '2024-05-30': 13.82,
            '2024-05-31': 12.48,
            '2024-06-03': 12.36,
            '2024-06-04': 13.15,
            '2024-06-05': 11.79,
            '2024-06-06': 11.68,
            '2024-06-07': 11.92,
            '2024-06-10': 12.34,
            '2024-06-11': 12.33,
            '2024-06-12': 10.06,
            '2024-06-13': 9.22,
            '2024-06-14': 9.76,
            '2024-06-17': 9.17,
            '2024-06-18': 8.74,
            '2024-06-20': 9.76,
            '2024-06-21': 10.21,
            '2024-06-24': 11.46,
            '2024-06-25': 10.32,
            '2024-06-26': 9.44,
            '2024-06-27': 8.86,
            '2024-06-28': 9.09,
            '2024-07-01': 8.36,
            '2024-07-02': 8.13,
            '2024-07-03': 7.63,
            '2024-07-05': 8.08,
            '2024-07-08': 7.79,
            '2024-07-09': 7.9,
            '2024-07-10': 7.79,
            '2024-07-11': 8.29,
            '2024-07-12': 7.8,
            '2024-07-15': 8.65,
            '2024-07-16': 9.37,
            '2024-07-17': 11.09,
            '2024-07-18': 11.73,
            '2024-07-19': 13.13,
            '2024-07-22': 11.15,
            '2024-07-23': 11.36,
            '2024-07-24': 15.92,
            '2024-07-25': 16.9,
            '2024-07-26': 14.4,
            '2024-07-29': 14.28,
            '2024-07-30': 16.66,
            '2024-07-31': 14.0,
            '2024-08-01': 17.55,
            '2024-08-02': 23.29,
            '2024-08-05': 35.68,
            '2024-08-06': 28.42,
            '2024-08-07': 27.92,
            '2024-08-08': 24.32,
            '2024-08-09': 20.96,
            '2024-08-12': 20.64,
            '2024-08-13': 18.08,
            '2024-08-14': 15.65,
            '2024-08-15': 14.23,
            '2024-08-16': 14.13,
            '2024-08-19': 13.36,
            '2024-08-20': 13.91,
            '2024-08-21': 14.0,
            '2024-08-22': 14.59,
            '2024-08-23': 12.97,
            '2024-08-26': 12.75,
            '2024-08-27': 12.6,
            '2024-08-28': 14.46,
            '2024-08-29': 14.67,
            '2024-08-30': 14.53,
            '2024-09-03': 20.46,
            '2024-09-04': 22.66,
            '2024-09-05': 20.65,
            '2024-09-06': 24.82,
            '2024-09-09': 21.98,
            '2024-09-10': 21.12,
            '2024-09-11': 18.34,
            '2024-09-12': 17.51,
            '2024-09-13': 17.69,
            '2024-09-16': 18.64,
            '2024-09-17': 18.79,
            '2024-09-18': 19.47,
            '2024-09-19': 16.97,
            '2024-09-20': 17.51,
            '2024-09-23': 17.18,
            '2024-09-24': 16.39,
            '2024-09-25': 16.33,
            '2024-09-26': 15.84,
            '2024-09-27': 17.74,
            '2024-09-30': 17.07,
            '2024-10-01': 19.25,
            '2024-10-02': 18.74,
            '2024-10-03': 19.83,
            '2024-10-04': 18.18,
            '2024-10-07': 20.21,
            '2024-10-08': 18.48,
            '2024-10-09': 18.24,
            '2024-10-10': 18.02,
            '2024-10-11': 18.17,
            '2024-10-14': 17.25,
            '2024-10-15': 18.29,
            '2024-10-16': 17.05,
            '2024-10-17': 15.45,
            '2024-10-18': 15.45,
            '2024-10-21': 15.11,
            '2024-10-22': 14.79,
            '2024-10-23': 16.36,
            '2024-10-24': 15.66,
            '2024-10-25': 17.01,
            '2024-10-28': 15.77,
            '2024-10-29': 15.23,
            '2024-10-30': 17.18,
            '2024-10-31': 20.32,
            '2024-11-01': 21.45,
            '2024-11-04': 20.6,
            '2024-11-05': 17.78,
            '2024-11-06': 14.39,
            '2024-11-07': 14.0,
            '2024-11-08': 13.91,
            '2024-11-11': 12.7,
            '2024-11-12': 12.18,
            '2024-11-13': 11.64,
            '2024-11-14': 11.84,
            '2024-11-15': 13.04,
            '2024-11-18': 12.68,
            '2024-11-19': 13.19,
            '2024-11-20': 13.37,
            '2024-11-21': 13.97,
            '2024-11-22': 12.85,
            '2024-11-25': 12.45,
            '2024-11-26': 12.58,
            '2024-11-27': 12.82,
            '2024-11-29': 12.08,
            '2024-12-02': 11.76,
            '2024-12-03': 11.89,
            '2024-12-04': 11.85,
            '2024-12-05': 11.74,
            '2024-12-06': 11.17,
            '2024-12-09': 12.04,
            '2024-12-10': 11.66,
            '2024-12-11': 10.92,
            '2024-12-12': 11.44,
            '2024-12-13': 11.08,
            '2024-12-16': 10.48,
            '2024-12-17': 11.13,
            '2024-12-18': 19.78,
            '2024-12-19': 19.16,
            '2024-12-20': 15.73,
            '2024-12-23': 13.26,
            '2024-12-24': 10.24,
            '2024-12-26': 10.04,
            '2024-12-27': 12.09,
            '2024-12-30': 14.19,
            '2024-12-31': 14.23,
            '2025-01-02': 14.94,
            '2025-01-03': 12.66,
            '2025-01-06': 11.33,
            '2025-01-07': 14.64,
            '2025-01-08': 14.98,
            '2025-01-10': 18.15,
            '2025-01-13': 17.76,
            '2025-01-14': 17.4,
            '2025-01-15': 14.14,
            '2025-01-16': 14.58,
            '2025-01-17': 14.1,
            '2025-01-21': 11.86,
            '2025-01-22': 11.42,
            '2025-01-23': 11.67,
            '2025-01-24': 11.89,
            '2025-01-27': 13.83,
            '2025-01-28': 12.53,
            '2025-01-29': 11.15,
            '2025-01-30': 11.12,
            '2025-01-31': 12.51,
            '2025-02-03': 14.39,
            '2025-02-04': 13.77,
            '2025-02-05': 12.25,
            '2025-02-06': 12.69,
            '2025-02-07': 13.48,
            '2025-02-10': 13.18,
            '2025-02-11': 13.37,
            '2025-02-12': 13.35,
            '2025-02-13': 12.06,
            '2025-02-14': 12.13,
            '2025-02-18': 11.85,
            '2025-02-19': 12.07,
            '2025-02-20': 12.19,
            '2025-02-21': 14.83,
            '2025-02-24': 15.61,
            '2025-02-25': 16.03,
            '2025-02-26': 16.22,
            '2025-02-27': 20.07,
            '2025-02-28': 18.48,
            '2025-03-03': 21.73,
            '2025-03-04': 22.02,
            '2025-03-05': 21.78,
            '2025-03-06': 24.87,
            '2025-03-07': 24.09,
            '2025-03-10': 27.52,
            '2025-03-11': 28.94,
            '2025-03-12': 27.0,
            '2025-03-13': 26.6,
            '2025-03-14': 24.94,
            '2025-03-17': 23.07,
            '2025-03-18': 24.49,
            '2025-03-19': 22.89,
            '2025-03-20': 22.68,
            '2025-03-21': 23.09,
            '2025-03-24': 20.03,
            '2025-03-25': 19.78,
            '2025-03-26': 21.66,
            '2025-03-27': 21.9,
            '2025-03-28': 26.06,
            '2025-03-31': 25.38,
            '2025-04-01': 24.89,
            '2025-04-02': 21.97,
            '2025-04-03': 33.55,
            '2025-04-04': 44.59,
            '2025-04-07': 43.44,
            '2025-04-08': 46.34,
            '2025-04-09': 39.41,
            '2025-04-10': 42.96,
            '2025-04-11': 43.05,
            '2025-04-14': 38.18,
            '2025-04-15': 40.18,
            '2025-04-16': 43.26,
            '2025-04-17': 40.38,
            '2025-04-21': 44.06,
            '2025-04-22': 41.47,
            '2025-04-23': 39.37,
            '2025-04-24': 35.58,
            '2025-04-25': 34.6,
            '2025-04-28': 34.38,
            '2025-04-29': 33.64,
            '2025-04-30': 34.04,
            '2025-05-01': 35.32,
            '2025-05-02': 32.67,
            '2025-05-05': 33.53,
            '2025-05-06': 35.01,
            '2025-05-07': 32.77,
            '2025-05-08': 31.18,
            '2025-05-09': 31.07,
            '2025-05-12': 23.65,
            '2025-05-13': 20.87,
            '2025-05-14': 20.46,
            '2025-05-15': 19.53,
            '2025-05-16': 19.74,
            '2025-05-19': 20.41,
            '2025-05-20': 20.41,
            '2025-05-21': 23.0,
            '2025-05-22': 22.22,
            '2025-05-23': 25.11,
            '2025-05-27': 19.79,
            '2025-05-28': 21.16,
            '2025-05-29': 22.0,
            '2025-05-30': 22.37,
            '2025-06-02': 21.97,
            '2025-06-03': 21.14,
            '2025-06-04': 21.24,
            '2025-06-05': 21.49,
            '2025-06-06': 20.17,
            '2025-06-09': 20.04,
            '2025-06-10': 19.62,
            '2025-06-11': 19.55,
            '2025-06-12': 19.95,
            '2025-06-13': 23.29,
            '2025-06-16': 20.51,
            '2025-06-17': 23.6,
            '2025-06-18': 21.79,
            '2025-06-20': 23.29,
            '2025-06-23': 21.93,
            '2025-06-24': 18.94,
            '2025-06-25': 17.88,
            '2025-06-26': 17.39,
            '2025-06-27': 17.36,
            '2025-06-30': 17.08,
            '2025-07-01': 18.01,
            '2025-07-02': 17.77,
            '2025-07-03': 17.93,
            '2025-07-07': 19.53,
            '2025-07-08': 18.41,
            '2025-07-09': 17.53,
            '2025-07-10': 16.93,
            '2025-07-11': 18.14,
            '2025-07-14': 19.06,
            '2025-07-15': 19.7,
            '2025-07-16': 19.51,
            '2025-07-17': 18.32,
            '2025-07-18': 18.74,
            '2025-07-21': 18.89,
            '2025-07-22': 18.56,
            '2025-07-23': 16.44,
            '2025-07-24': 17.25,
            '2025-07-25': 16.95,
            '2025-07-28': 16.0,
            '2025-07-29': 16.65,
            '2025-07-30': 15.27,
            '2025-07-31': 16.95,
            '2025-08-01': 21.53,
            '2025-08-04': 17.71,
            '2025-08-05': 18.88,
            '2025-08-06': 17.79,
            '2025-08-07': 16.9,
            '2025-08-08': 15.9,
            '2025-08-11': 16.61,
            '2025-08-12': 15.07,
            '2025-08-13': 14.51,
            '2025-08-14': 15.01,
            '2025-08-15': 15.63,
            '2025-08-18': 15.02,
            '2025-08-19': 15.65,
            '2025-08-20': 16.08,
            '2025-08-21': 16.8,
            '2025-08-22': 13.77,
            '2025-08-25': 14.11,
            '2025-08-26': 13.51,
            '2025-08-27': 13.69,
            '2025-08-28': 14.21,
            '2025-08-29': 15.24,
            '2025-09-02': 16.69,
            '2025-09-03': 16.37,
            '2025-09-04': 15.5,
            '2025-09-05': 15.77,
            '2025-09-08': 15.36,
            '2025-09-09': 15.1,
            '2025-09-10': 14.21,
            '2025-09-11': 13.9,
            '2025-09-12': 14.02,
            '2025-09-15': 14.26,
            '2025-09-16': 14.95,
            '2025-09-17': 14.51,
            '2025-09-18': 14.53,
            '2025-09-19': 14.76,
            '2025-09-22': 14.58,
            '2025-09-23': 15.29,
            '2025-09-24': 15.01,
            '2025-09-25': 15.53,
            '2025-09-26': 14.07,
            '2025-09-29': 14.35,
            '2025-09-30': 13.68,
            '2025-10-01': 13.42,
            '2025-10-02': 13.72,
            '2025-10-03': 14.23,
            '2025-10-06': 13.04,
            '2025-10-07': 14.56,
            '2025-10-08': 13.57,
            '2025-10-09': 13.54,
            '2025-10-10': 18.92,
            '2025-10-13': 16.0,
            '2025-10-14': 17.6,
            '2025-10-15': 17.04,
            '2025-10-16': 21.31,
            '2025-10-17': 17.09,
            '2025-10-20': 14.54,
            '2025-10-21': 14.67,
            '2025-10-22': 15.45,
            '2025-10-23': 14.5,
            '2025-10-24': 13.94,
            '2025-10-27': 13.28,
            '2025-10-28': 13.89,
            '2025-10-29': 13.52,
            '2025-10-30': 15.48,
            '2025-10-31': 16.51,
            '2025-11-03': 15.91,
            '2025-11-04': 17.81,
            '2025-11-05': 16.27,
            '2025-11-06': 17.13,
            '2025-11-07': 16.63,
            '2025-11-10': 14.64,
            '2025-11-11': 15.33,
            '2025-11-12': 15.74,
            '2025-11-13': 17.44,
            '2025-11-14': 17.75,
            '2025-11-17': 19.69,
            '2025-11-18': 21.25,
            '2025-11-19': 20.04,
            '2025-11-20': 22.49,
            '2025-11-21': 20.93,
            '2025-11-24': 18.77,
            '2025-11-25': 16.06,
            '2025-11-26': 15.57,
            '2025-11-28': 15.38,
            '2025-12-01': 16.23,
            '2025-12-02': 15.74,
            '2025-12-03': 15.09,
            '2025-12-04': 14.42,
            '2025-12-05': 14.44,
            '2025-12-08': 14.82,
            '2025-12-09': 15.12,
            '2025-12-10': 13.68,
            '2025-12-11': 13.01,
            '2025-12-12': 14.12,
            '2025-12-15': 14.83,
            '2025-12-16': 15.38,
            '2025-12-17': 16.65,
            '2025-12-18': 15.74,
            '2025-12-19': 13.24,
            '2025-12-22': 12.29,
            '2025-12-23': 12.43,
            '2025-12-24': 12.37,
            '2025-12-26': 12.35,
            '2025-12-29': 12.79,
            '2025-12-30': 13.02,
            '2025-12-31': 13.22,
            '2026-01-02': 12.68,
            '2026-01-05': 12.78,
            '2026-01-06': 12.6,
            '2026-01-07': 12.94,
            '2026-01-08': 12.62,
            '2026-01-09': 12.13,
            '2026-01-12': 12.4,
            '2026-01-13': 13.01,
            '2026-01-14': 13.68,
            '2026-01-15': 12.74,
            '2026-01-16': 13.36,
            '2026-01-20': 16.24,
            '2026-01-21': 13.63,
            '2026-01-22': 12.75,
            '2026-01-23': 12.96,
            '2026-01-26': 12.57,
            '2026-01-27': 12.67,
            '2026-01-28': 12.44,
            '2026-01-29': 13.03,
            '2026-01-30': 14.41,
        }
        # Convert string dates to date objects and create OHLC structure to match CSV format
        self.cor1m_data = {}
        self.cor3m_data = {}
        self.cor1m_hourly_data = {}
        self.cor3m_hourly_data = {}
        
        for date_str, close_val in sample_cor1m_raw.items():
            date_obj = datetime.strptime(date_str, '%Y-%m-%d').date()
            # Add small variance to create OHLC from close price
            ohlc = {
                'close': close_val,
                'open': close_val * 0.999,
                'high': close_val * 1.001,
                'low': close_val * 0.998
            }
            self.cor1m_data[date_obj] = ohlc
            
            # Create hourly entry (16:00 UTC as representative hour)
            dt = datetime.combine(date_obj, datetime.min.time()).replace(hour=16)
            hour_key = dt.isoformat()
            self.cor1m_hourly_data[hour_key] = ohlc
        
        for date_str, close_val in sample_cor3m_raw.items():
            date_obj = datetime.strptime(date_str, '%Y-%m-%d').date()
            # Add small variance to create OHLC from close price
            ohlc = {
                'close': close_val,
                'open': close_val * 0.999,
                'high': close_val * 1.001,
                'low': close_val * 0.998
            }
            self.cor3m_data[date_obj] = ohlc
            
            # Create hourly entry (16:00 UTC as representative hour)
            dt = datetime.combine(date_obj, datetime.min.time()).replace(hour=16)
            hour_key = dt.isoformat()
            self.cor3m_hourly_data[hour_key] = ohlc
        
        self.debug(f"[DATA LOAD] ✓ Loaded {len(self.cor1m_hourly_data)} embedded COR1M and {len(self.cor3m_hourly_data)} embedded COR3M entries")

    def on_data(self, data: Slice):
        """Main algorithm logic"""
        
        # Check if VXX data is available
        if not data.contains_key(self.vxx):
            return
        
        try:
            vxx_data = data[self.vxx]
            if vxx_data is None or vxx_data.close is None:
                return
            vxx_price = vxx_data.close
        except:
            return
        
        current_date = self.time.date()
        current_hour = self.time.hour
        
        # Build hourly timestamp key in ISO format for lookup
        current_dt = datetime(current_date.year, current_date.month, current_date.day, current_hour, 0, 0)
        current_hour_key = current_dt.isoformat()
        
        # Get correlation data for this hour (from hourly data)
        cor1m_value = None
        cor3m_value = None
        
        # Try exact hourly match first
        if current_hour_key in self.cor1m_hourly_data:
            cor1m_value = self.cor1m_hourly_data[current_hour_key]['close']
        if current_hour_key in self.cor3m_hourly_data:
            cor3m_value = self.cor3m_hourly_data[current_hour_key]['close']
        
        # If we don't have this hour's data, try to use the most recent available
        if cor1m_value is None or cor3m_value is None:
            # Find closest hour (search backwards up to 24 hours)
            for hour_offset in range(1, 25):
                check_dt = current_dt - timedelta(hours=hour_offset)
                check_hour_key = check_dt.isoformat()
                if cor1m_value is None and check_hour_key in self.cor1m_hourly_data:
                    cor1m_value = self.cor1m_hourly_data[check_hour_key]['close']
                if cor3m_value is None and check_hour_key in self.cor3m_hourly_data:
                    cor3m_value = self.cor3m_hourly_data[check_hour_key]['close']
                if cor1m_value and cor3m_value:
                    break
        
        if cor1m_value is None or cor3m_value is None:
            self.debug(f"[ON_DATA] {self.time}: ✗ MISSING - COR1M:{cor1m_value} COR3M:{cor3m_value}")
            return
        
        self.debug(f"[ON_DATA] {self.time}: ✓ DATA ACCESSED - COR1M={cor1m_value:.2f} | COR3M={cor3m_value:.2f}")
        
        # Calculate difference and update RSI
        diff = cor1m_value - cor3m_value
        self.rsi_diff.update(self.time, diff)
        
        if not self.rsi_diff.is_ready:
            self.debug(f"[RSI WARMUP] {self.time.date()}: RSI initializing... Diff={diff:.4f}")
            return
        
        rsi_value = self.rsi_diff.current.value
        
        # Debug output
        self.debug(f"[SIGNAL] {self.time.date()}: COR1M={cor1m_value:.2f} | COR3M={cor3m_value:.2f} | Diff={diff:.4f} | RSI={rsi_value:.2f} | VXX={vxx_price:.2f} | Pos={'SHORT' if self.is_short else 'FLAT'}")
        
        # Entry: RSI oversold (< 50) - reversal signal to short vol
        if not self.is_short and rsi_value < self.rsi_threshold:
            self.set_holdings(self.vxx, -self.position_size)
            self.is_short = True
            self.entry_price = vxx_price
            self.trade_count += 1
            self.debug(f"[TRADE {self.trade_count}] ▼ ENTRY @ {self.time.date()}: SHORT VXX @ {vxx_price:.2f} | RSI={rsi_value:.2f}<{self.rsi_threshold} | Diff={diff:.4f}")
        
        # Exit: VXX rises above threshold or RSI recovers
        elif self.is_short and (vxx_price > self.vxx_close_threshold or rsi_value > 60):
            exit_reason = f"VXX={vxx_price:.2f}>{self.vxx_close_threshold}" if vxx_price > self.vxx_close_threshold else f"RSI={rsi_value:.2f}>60"
            self.liquidate(self.vxx)
            self.is_short = False
            profit = self.entry_price - vxx_price
            profit_pct = (profit / self.entry_price) * 100
            self.debug(f"[TRADE {self.trade_count}] ▲ EXIT @ {self.time.date()}: CLOSE @ {vxx_price:.2f} | {exit_reason} | P/L: {profit:.2f} ({profit_pct:.1f}%)")
    
    def on_end_of_algorithm(self):
        """Called at the end of the algorithm"""
        self.debug(f"\n{'='*90}")
        self.debug(f"[FINAL SUMMARY]")
        self.debug(f"[FINAL] Algorithm ended: {self.time.date()}")
        self.debug(f"[FINAL] Total trades executed: {self.trade_count}")
        self.debug(f"[FINAL] COR1M data points: {len(self.cor1m_data)} rows")
        self.debug(f"[FINAL] COR3M data points: {len(self.cor3m_data)} rows")
        self.debug(f"[FINAL] Portfolio value: ${self.portfolio.total_portfolio_value:.2f}")
        self.debug(f"[FINAL] Cash remaining: ${self.portfolio.cash:.2f}")
        self.debug(f"{'='*90}\n")
